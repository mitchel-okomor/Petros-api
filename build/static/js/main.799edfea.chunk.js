(this["webpackJsonppetros-frontend"]=this["webpackJsonppetros-frontend"]||[]).push([[0],{35:function(e,t,a){e.exports=a(74)},40:function(e,t,a){},41:function(e,t,a){},42:function(e,t,a){},46:function(e,t,a){},47:function(e,t,a){},53:function(e,t,a){},71:function(e,t,a){},72:function(e,t,a){},73:function(e,t,a){},74:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(31),c=a.n(l),o=(a(40),a(41),a(13)),i=a(15),s=a(7),u=a(8),m=a(10),d=a(9),h=(a(42),a(4)),p=Object(h.a)(),f=a(32),v=a.n(f),E=function(){var e=localStorage.token;if(e){var t=v()(e).exp;return!(Date.now()>=1e3*t)||(localStorage.removeItem("token"),localStorage.removeItem("userId"),!1)}return!1},g=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).handleChange=function(e){n.setState(Object(i.a)({},e.target.name,e.target.value))},n.handleSubmit=function(e){e.preventDefault();fetch("/login",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(n.state)}).then((function(e){return e.json()})).then((function(e){"error"===e.status?n.setState({loginStatus:e.status,loginMessage:e.message}):(n.setState({loginStatus:e.status,loginMessage:e.message,token:e.data.token,userId:e.data.user}),localStorage.setItem("token",n.state.token),localStorage.setItem("userId",n.state.userId),p.push("/admin"))})).catch((function(e){console.log(e)}))},n.state={loginMessage:""},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){E()?p.push("/admin"):p.push("/login")}},{key:"render",value:function(){return r.a.createElement("div",{className:"login"},r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("br",null),r.a.createElement("h1",null,"Login to Admin Panel"),r.a.createElement("br",null),r.a.createElement("form",null,r.a.createElement("fieldset",null,r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"first_name"},"email:")," ",r.a.createElement("br",null),r.a.createElement("input",{type:"email",name:"email",id:"email",placeholder:"Enter email address",value:this.state.value,onChange:this.handleChange,required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"last_name"},"Password:"),r.a.createElement("br",null),r.a.createElement("input",{type:"password",name:"password",id:"password",placeholder:"Enter password",value:this.state.value,onChange:this.handleChange,required:!0})),r.a.createElement("div",{className:this.state.loginStatus},this.state.loginMessage),r.a.createElement("button",{onClick:this.handleSubmit},"Submit"))))}}]),a}(r.a.Component),b=a(1),j=a.n(b),k=a(3),w=(a(46),a(12)),S=(a(47),function(){localStorage.removeItem("token"),localStorage.removeItem("userId"),console.log("logged out successfully"),p.push("/"),window.location.reload()}),C=function(e){return r.a.createElement("header",null,r.a.createElement("div",{className:"header-bar"},r.a.createElement("div",{className:"logo"},"Admin Panel"),r.a.createElement("ul",null,r.a.createElement("li",null,r.a.createElement(w.a,{to:"/"},e.user)),r.a.createElement("li",null,r.a.createElement(w.a,{to:"/",onClick:function(){S()}},"Logout")))))},O=(a(53),a(17)),y=a.n(O),x=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).handleChange=function(e){var t=e.target,a="image"===t.name?t.files[0]:t.value,r=t.name;n.setState(Object(i.a)({},r,a))},n.handleSubmit=function(){var e=Object(k.a)(j.a.mark((function e(t){var a,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,(a=new FormData).append("title",n.state.title),a.append("description",n.state.description),a.append("image",n.state.image,n.state.image.name),a.append("date",n.state.date),r="/article/".concat(localStorage.userId),t.preventDefault(),e.next=10,y.a.post(r,a,{onUploadProgress:function(e){console.log("upload progress "+Math.round(e.loaded/e.total*100)+"%")}});case 10:200===e.sent.status&&(alert("Article Added successfully"),window.location.reload()),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),console.log(e.t0),alert(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(t){return e.apply(this,arguments)}}(),n.state={},n}return Object(u.a)(a,[{key:"render",value:function(){return r.a.createElement("div",{className:"news-panel"},r.a.createElement("h2",null," Create News"),r.a.createElement("hr",null),r.a.createElement("br",null),r.a.createElement("form",null,r.a.createElement("fieldset",null,r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"title"},"Title:")," ",r.a.createElement("br",null),r.a.createElement("input",{name:"title",placeholder:"Enter title",value:this.state.value,onChange:this.handleChange,required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"description"},"body:")," ",r.a.createElement("br",null),r.a.createElement("textarea",{placeholder:"Enter description",name:"description",value:this.state.value,onChange:this.handleChange,required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"file"},"Image Upload:")," ",r.a.createElement("br",null),r.a.createElement("input",{placeholder:"select image",name:"image",type:"file",value:this.state.value,onChange:this.handleChange})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"date"},"Date:")," ",r.a.createElement("br",null),r.a.createElement("input",{placeholder:"E.g 21st December, 2018",name:"date",value:this.state.value,onChange:this.handleChange,required:!0})),r.a.createElement("button",{onClick:this.handleSubmit},"Submit"))))}}]),a}(r.a.Component),N=(a(71),function(e){var t=function(){var e=Object(k.a)(j.a.mark((function e(t){var a,n;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("article id is: "+t),e.prev=1,a="/article/".concat(t,"/").concat(localStorage.userId),e.next=5,fetch(a,{method:"delete",headers:{"Content-Type":"application/json",authorization:localStorage.token}});case 5:n=e.sent,console.log(n),200===n.status&&(alert("Article deleted successfully"),window.location.reload()),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.log(e.t0),alert(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})));return function(t){return e.apply(this,arguments)}}();return r.a.createElement("li",null,r.a.createElement("em",null,e.article.date_created),r.a.createElement("br",null),r.a.createElement("img",{src:"/"+e.article.image_url,alt:"article"})," ",r.a.createElement("br",null),r.a.createElement(w.a,{to:"#"}," ",e.article.title),r.a.createElement("br",null),r.a.createElement("p",null,e.article.description),r.a.createElement("br",null),r.a.createElement("div",{className:"list-action"}," ",r.a.createElement(w.a,{to:"/edit/"+e.article.id,article:e.article},r.a.createElement("button",{id:"edit"},"Edit"))," ",r.a.createElement("span",null,r.a.createElement("button",{id:"delete",onClick:function(){window.confirm("Delete the item?")&&t(e.article.id)}},"Delete"))))}),D=(a(72),function(e){return r.a.createElement("div",{className:"Loading",style:{width:"28px",height:"28px"}})}),I=function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).fetch=Object(k.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.setState({loading:!0}),e.prev=1,"/articles",e.next=5,fetch("/articles",{method:"get"});case 5:return t=e.sent,e.abrupt("return",t.json());case 9:e.prev=9,e.t0=e.catch(1),n.setState({error:e.t0});case 12:case"end":return e.stop()}}),e,null,[[1,9]])}))),n.getArticles=Object(k.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.fetch();case 3:if(void 0!==(t=e.sent)){e.next=7;break}return n.setState({error:"Unable to load articles"}),e.abrupt("return");case 7:n.setState({loading:!1,articles:t.data}),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),n.setState({error:e.t0}),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,10]])}))),n.state={loading:!1,articles:[]},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.getArticles()}},{key:"render",value:function(){var e=this.state,t=e.loading,a=e.error,n=e.articles;return t?r.a.createElement("div",{className:"loading-container"},r.a.createElement(D,null)," "):a?r.a.createElement("div",{className:"error"},a):r.a.createElement("div",{className:"news-edit-panel"},r.a.createElement("div",{className:"news"},r.a.createElement("h2",null,"Latest News"),r.a.createElement("br",null),r.a.createElement("ul",null,n.map((function(e){return r.a.createElement(N,{key:e.id,article:e})})))))}}]),a}(r.a.Component),A=function(e){return function(t){Object(m.a)(n,t);var a=Object(d.a)(n);function n(e){var t;return Object(s.a)(this,n),(t=a.call(this,e)).state={isAutenticated:!1},t}return Object(u.a)(n,[{key:"componentDidMount",value:function(){E()?this.setState({isAutenticated:!0}):p.push("/login")}},{key:"render",value:function(){return this.state.isAutenticated?r.a.createElement(e,null):null}}]),n}(n.Component)}(function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).handleRerender=function(e){console.log("rerendering"),n.setState({})},n.fetch=Object(k.a)(j.a.mark((function e(){var t,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="http://localhost:4000/user/"+localStorage.userId,e.next=4,fetch(t,{method:"get",headers:{"Content-Type":"application/json",authorization:localStorage.token}});case 4:return a=e.sent,e.abrupt("return",a.json());case 8:e.prev=8,e.t0=e.catch(0),n.setState({error:e.t0});case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),n.getUser=Object(k.a)(j.a.mark((function e(){var t;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.fetch();case 3:t=e.sent,n.setState({loading:!1,user:t.data}),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),n.state={loading:!0,user:"",error:""},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.getUser(),console.log(this.state.user)}},{key:"render",value:function(){var e=this.state.user;return r.a.createElement("div",{className:"admin"},r.a.createElement(C,{user:e.firstname}),r.a.createElement("div",{className:"panels"},r.a.createElement(x,{rerenderHandler:this.handleRerender}),r.a.createElement(I,null)))}}]),a}(r.a.Component)),F=(a(73),function(e){Object(m.a)(a,e);var t=Object(d.a)(a);function a(e){var n;return Object(s.a)(this,a),(n=t.call(this,e)).fetch=Object(k.a)(j.a.mark((function e(){var t,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t="/article/".concat(n.props.match.params.id),e.next=4,fetch(t,{method:"get"});case 4:return a=e.sent,e.abrupt("return",a.json());case 8:e.prev=8,e.t0=e.catch(0),n.setState({error:e.t0});case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),n.getArticles=Object(k.a)(j.a.mark((function e(){var t,a;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.fetch();case 2:t=e.sent,a=t.data[0],n.setState(a);case 5:case"end":return e.stop()}}),e)}))),n.handleChange=function(e){var t=e.target,a="image"===t.name?t.files[0]:t.value,r=t.name;n.setState(Object(i.a)({},r,a))},n.handleSubmit=function(){var e=Object(k.a)(j.a.mark((function e(t){var a,r;return j.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(n.state),e.prev=1,(a=new FormData).append("title",n.state.title),a.append("description",n.state.description),a.append("image",n.state.image,n.state.image.name),a.append("date",n.state.date),r="http://localhost:4000/article/".concat(n.props.match.params.id),t.preventDefault(),e.next=11,y.a.put(r,a,{onUploadProgress:function(e){console.log("upload progress "+Math.round(e.loaded/e.total*100)+"%")}});case 11:200===e.sent.status&&(alert("Article updated successfully"),p.push("/admin")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),console.log(e.t0),alert(e.t0);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(t){return e.apply(this,arguments)}}(),n.state={},n}return Object(u.a)(a,[{key:"componentDidMount",value:function(){this.getArticles()}},{key:"render",value:function(){return r.a.createElement("div",{className:"edit-form"},r.a.createElement("div",{className:"edit-news-panel"},r.a.createElement("div",{className:"heading"}," ",r.a.createElement(w.a,{to:"/admin"},r.a.createElement("a",null,"Go back")," "),"     ",r.a.createElement("span",null," Edit news")," "),r.a.createElement("form",null,r.a.createElement("fieldset",null,r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"title"},"Title:")," ",r.a.createElement("br",null),r.a.createElement("input",{name:"title",placeholder:"Enter title",value:this.state.title,onChange:this.handleChange,required:!0})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"description"},"body:")," ",r.a.createElement("br",null),r.a.createElement("textarea",{placeholder:"Enter description",name:"description",value:this.state.description,onChange:this.handleChange,required:!0}," ")),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"file"},"Image Upload:")," ",r.a.createElement("br",null),r.a.createElement("input",{placeholder:"select image",name:"image",type:"file",value:this.state.value,onChange:this.handleChange})),r.a.createElement("div",null,r.a.createElement("label",{htmlFor:"date"},"Date:")," ",r.a.createElement("br",null),r.a.createElement("input",{placeholder:"E.g 21st December, 2018",name:"date",value:this.state.date_created,onChange:this.handleChange,required:!0})),r.a.createElement("button",{onClick:this.handleSubmit},"Submit")))))}}]),a}(r.a.Component));var M=function(){return r.a.createElement("div",{className:"App"},r.a.createElement(o.b,{history:p},r.a.createElement(o.c,null,r.a.createElement(o.a,{exact:!0,path:"/",component:A}),r.a.createElement(o.a,{path:"/admin",component:A}),r.a.createElement(o.a,{path:"/login",component:g}),r.a.createElement(o.a,{path:"/edit/:id",component:F}))))};c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root"))}},[[35,1,2]]]);
//# sourceMappingURL=main.799edfea.chunk.js.map